<!-- 树组件 -->
<div :id="containerId" class="tree-select height36 lh36 br3" :disabled="disabled">
  <el-popover
    :popper-class="`tree-select__popover ${popoverClass}`"
    placement="bottom"
    :show-arrow="false"
    style="min-width: 200px"
    :width="containerWidth"
    :offset="popoverOffset"
    v-model:visible="popoverVisible"
    trigger="click"
    :append-to-body="false"
  >
    <template #reference>
      <div class="el-select" :disabled="disabled">
        <div class="select-trigger">
          <div class="el-input el-input--suffix tree-select--wrap" :style="{ width: `calc(${containerWidth} - 2px)` }">
            <!-- 单选 start -->
            <div
              v-if="!multiple && treeNodeList && treeNodeList.length === 1"
              class="el-select__single"
              :title="treeNodeList && treeNodeList.length > 0 && treeNodeList[0] && treeNodeList[0][defaultProps['label']] ? treeNodeList[0][defaultProps['label']] : ''"
            >
              {{ treeNodeList && treeNodeList.length > 0 && treeNodeList[0] && treeNodeList[0][defaultProps['label']] ?
              treeNodeList[0][defaultProps['label']] : '' }}
            </div>
            <!-- 单选 end -->
            <!-- 多选 start -->
            <div v-if="multiple && treeNodeList && treeNodeList.length > 0" class="el-select__tags scrollw4">
              <span
                class="el-tag el-tag--info el-tag--small el-tag--light"
                v-for="(item, index) in treeNodeList"
                :key="index"
              >
                <span
                  class="el-select__tags-text"
                  :title="item[defaultProps['label']] ? item[defaultProps['label']] : ''"
                >
                  {{ item[defaultProps['label']] ? item[defaultProps['label']] : '' }}
                </span>
                <i class="iconfont icon-Close" @click="deleteSelectKey($event, index)" title="删除"></i>
              </span>
            </div>
            <!-- 多选 end -->
            <div
              v-if="
                  !treeNodeList || (treeNodeList && treeNodeList.length === 0)
                "
              class="el-select-placeholder"
            >
              {{ placeholder }}
            </div>
            <span
              :class="[
                  'el-input__suffix',
                  allowClear && treeNodeList && treeNodeList.length > 0 && !disabled
                    ? 'allow-clear'
                    : '',
                  popoverVisible ? 'popper-visible' : ''
                ]"
            >
              <!-- 上下箭头 start -->
              <span class="el-input__suffix-inner arrow-icon">
                <el-icon>
                  <ArrowDown v-show="!popoverVisible"></ArrowDown>
                  <ArrowUp v-show="popoverVisible"></ArrowUp>
                </el-icon>
              </span>
              <!-- 上下箭头 end -->
              <!-- 清空按钮 start -->
              <span class="el-input__suffix-inner close-icon" @click="emptySelectKeys($event)">
                <i class="iconfont icon-Close-Circle-Fill"></i>
              </span>
              <!-- 清空按钮 end -->
            </span>
          </div>
        </div>
      </div>
    </template>
    <!-- 下拉面板 start -->
    <!-- 增加最小宽度 -->
    <div class="tree-select-panel" :style="{ minWidth: minWidth }">
      <!-- 单选按钮 start -->
      <div class="tree-radio--box" v-if="radioData && radioData.length > 0">
        <el-radio-group v-model="treeType" @change="radioChange" :disabled="disabled">
          <el-radio v-for="(item, index) in radioData" :key="index" :label="item.value">{{ item.label }} </el-radio>
        </el-radio-group>
      </div>
      <!-- 单选按钮 end -->
      <!-- 查询框 start -->
      <div class="tree-search--box" v-if="showSearch">
        <input placeholder="请输入搜索内容" suffix-icon="el-icon-search" v-inputFilter:search v-model="searchValue" />
      </div>
      <!-- 查询框 end -->
      <!-- 树 start -->
      <div
        class="tree-select--box"
        v-loading="queryLoading"
        :style="{ paddingTop: '8px', margin: showSearch ? '0 12px' : '0' }"
      >
        <el-tree-v2
          v-if="!queryLoading"
          :height="240"
          :check-on-click-node="false"
          :disabled="disabled"
          ref="treeRef"
          :item-size="34"
          :data="treeData"
          :show-checkbox="multiple"
          :highlight-current="true"
          :expand-on-click-node="false"
          :check-strictly="true"
          :filter-method="filtertreeNodeList"
          :default-expanded-keys="compExpandKeys"
          :props="{...defaultProps,value: nodeKey}"
          :default-checked-keys="checkedArr"
          @node-click="onNodeClick"
          @check="onCheck"
        >
          <template #default="{ node, data }">
            <span
              :class="[
                'custom-tree-node',
                'flex-row-justify-center',
                checkedArr.includes(data[nodeKey]) ? 'custom-tree-node-active' : ''
                ]"
              :disabled="data[disabledProps.disabledKey] === disabledProps.disabledValue || disabled"
              v-html="formatTreeLabel(data[defaultProps.label])"
            >
            </span>
          </template>
        </el-tree-v2>
        <div
          v-show="(!treeData || treeData?.length ===0) && !queryLoading"
          class="tree-select--box-nodata flex-column-center-center"
        >
          <img src="../../assets/img/common/common-data-none.svg" alt="nodata" />
          <span class="mt8">暂无数据</span>
        </div>
      </div>
      <!-- 树 end -->
    </div>
    <!-- 下拉面板 end -->
  </el-popover>
</div>
