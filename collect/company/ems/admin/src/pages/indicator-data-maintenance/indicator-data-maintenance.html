<div class="indicator-data-maintenance">
  <h5>指标数据维护</h5>
  <!-- 内容 -->
  <div class="idm-content">
    <!-- 搜索栏 -->
    <el-form :inline="true" :model="formInline" class="idm-content-search" @submit.native.prevent>
      <el-form-item label="">
        <el-input
          v-inputFilter:search
          v-model="formInline.keyword"
          @keyup.native.enter="onSearch"
          placeholder="请输入节点名称"
          maxlength="20"
        >
        </el-input>
      </el-form-item>
      <el-form-item label="选择月份">
        <el-date-picker
          :disabledDate="onDisableDateCb"
          v-model="formInline.month"
          type="month"
          placeholder="选择月"
          :clearable="false"
        >
        </el-date-picker>
      </el-form-item>
      <el-form-item label="树类型">
        <el-select v-model="formInline.treeType" placeholder="请选择树类型">
          <el-option v-for="item in treeTypeData" :key="item.code" :label="item.name" :value="item.code"></el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="节点类型" v-if="formInline.treeType !== TREE_TYPE">
        <el-select v-model="formInline.nodeType" placeholder="请选择节点类型">
          <el-option v-for="item in nodeTypeData" :key="item.code" :label="item.name" :value="item.code"></el-option>
        </el-select>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="onSearch">查询</el-button>
      </el-form-item>
      <el-form-item>
        <el-button @click="onReset">重置</el-button>
      </el-form-item>
    </el-form>
    <!-- 工具栏 -->
    <section class="idm-content-tool">
      <div class="idm-content-tool-label">
        <span class="idm-content-tool-label-title">数据列表</span>
        <span class="idm-content-tool-label-desc"
          >{{formInline.treeType !== TREE_TYPE ?
          '面积、床位数、空调面积、拥有人数最新月份的数据会自动沿用上月数据，维护后则按维护数据计算，请及时更新维护。' :
          '面积最新月份的数据会自动沿用上月数据，维护后则按维护数据计算，请及时更新维护。'}}
        </span>
      </div>
      <div class="idm-content-tool-btn">
        <button @click="goNextPage" v-if="formInline.treeType !== TREE_TYPE">指标管理</button>
        <!-- 导入 -->
        <button @click="handleFileUpload">导入</button>
        <button primary @click="downLoadDialog">{{ exportLoading ? '正在下载模板' : '下载模板'}}</button>
      </div>
    </section>
    <!-- 列表 -->
    <section v-loading="loading" class="idm-content-table" id="wrap">
      <el-table
        v-if="!loading && columnHeader?.length !== 0"
        :data="tableData"
        style="width: 100%"
        height="650px"
        row-key="treeId"
        :border="false"
        :default-expand-all="expandAll"
        :expand-row-keys="expandedKeys"
        @expand-change="handleExpand"
        lazy
        :load="loadChildren"
        :tree-props="{ children: 'children', hasChildren: 'hasChildren' }"
        stripe
      >
        <el-table-column
          label="节点名称"
          :show-overflow-tooltip="true"
          :formatter="formatter"
          align="center"
          :width="tableTreeNameWidth"
          fixed
        >
          <template #default="scope">
            <span v-html="formatTreeName(scope.row.name)"></span>
          </template>
        </el-table-column>
        <el-table-column
          prop="nodeTypeName"
          min-width="120"
          label="节点类型"
          :formatter="formatter"
          show-overflow-tooltip
          align="center"
          v-if="isShowNodeType"
          fixed
        >
        </el-table-column>
        <el-table-column
          min-width="180px"
          v-for="(item, index) in columnHeader"
          :key="index"
          align="center"
          show-overflow-tooltip
        >
          <template #header>
            <div class="idm-table-container">
              <div class="idm-table-header" :title="item.value">{{ item.value }}</div>
              <te-tooltip placement="top" effect="dark" v-if="isDepartment && item.description">
                <template #content>
                  <div v-html="item.description" style="white-space: normal; word-break: break-all"></div>
                </template>
                <icon-explain class="idm-table-explain" />
              </te-tooltip>
            </div>
          </template>
          <template #default="scope">
            <span
              v-if="
              !scope.row?.benchmarkingCorrelationDataValueQueryVOList?.[index]?.show
            "
            >
              {{ scope.row?.benchmarkingCorrelationDataValueQueryVOList?.[index] .value ||
              scope.row?.benchmarkingCorrelationDataValueQueryVOList?.[index] .value === 0 ?
              scope.row?.benchmarkingCorrelationDataValueQueryVOList?.[index].value : "--" }}
            </span>
            <el-input
              type="text"
              min="0"
              v-if="scope.row?.benchmarkingCorrelationDataValueQueryVOList?.[index]?.show"
              step="1"
              v-model="
                scope.row.benchmarkingCorrelationDataValueQueryVOList[index].value"
              v-inputFilter:number="{ integral: 10, decimal: 4 }"
              onkeyup="this.value = this.value.replace(/[^\d.]/g,'');"
              :class="'input_'+ index"
              @blur="
                loseFocus(
                  scope.row,
                  scope.row.benchmarkingCorrelationDataValueQueryVOList,
                  index
                )
              "
            />
            <span v-else style="float: right; margin-right: 4px; cursor: pointer">
              <img
                style="width: 14px; height: 14px"
                src="@/assets/img/benchmarking/bm-edit.png"
                @click="
                editUnit(
                  scope.row,
                  scope.row.benchmarkingCorrelationDataValueQueryVOList,
                  index
                )
              "
                alt="edit"
              />
            </span>
          </template>
        </el-table-column>
      </el-table>
      <no-data v-if="!loading && columnHeader?.length === 0"></no-data>
    </section>
  </div>
  <!-- 导出弹框 -->
  <div class="add-dialog" v-drag>
    <el-dialog title="模板下载时间" v-model="dialogFormVisible" width="560px" :close-on-click-modal="false">
      <el-form :model="pageForm" label-position="right" label-width="70px">
        <el-form-item label="选择月份" prop="name">
          <div class="flex-row-center-center">
            <el-date-picker
              :disabledDate="startMonth"
              v-model="monthStart"
              type="month"
              placeholder="选择月"
              style="width: 215px"
              :clearable="false"
            >
            </el-date-picker
            ><span class="ml8 mr8">-</span>
            <el-date-picker
              :disabledDate="endMonth"
              v-model="monthEnd"
              type="month"
              placeholder="选择月"
              style="width: 215px"
              :clearable="false"
            >
            </el-date-picker>
          </div>
        </el-form-item>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <button @click="() => {dialogFormVisible = false; exportLoading = false;}">取消</button>
          <button primary @click="downLoad">确定</button>
        </span>
      </template>
    </el-dialog>
  </div>
</div>
