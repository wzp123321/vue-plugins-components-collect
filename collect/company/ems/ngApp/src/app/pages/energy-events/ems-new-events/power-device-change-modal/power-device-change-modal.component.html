<!-- 
    entryMode: TEntryMode; // 录入模式 TBinding | TManual
    energyNode?: string; // 设备
    relationData?: IRelationData[];  // 人工录入
    IRelationData {
      energyItemCode: string;
      energyConsumption: number;
      unit?: string;
    }
    changeType: TPowerDeviceChange; // 变更
 -->
<div class="power_device-change-modal">
  <!-- 标题 -->
  <div id="eventTitle" class="modal-group">
    <label class="label-header">事件标题</label>
    <div class="mt10">
      <ion-input
        mode="md"
        placeholder="请输入标题0/15"
        class="label-input"
        maxlength="15"
        [(ngModel)]="data.eventTitle"
        [class.emptyPower]="isShowEmptyMarker && !data.eventTitle"
      ></ion-input>
    </div>
  </div>
  <!-- 时间 -->
  <div class="modal-group mt15 modal-time">
    <div id="startTime" class="modal-start-time">
      <label class="label-header">开始时间</label>
      <div class="mt10">
        <div
          class="lable-btn"
          (click)="timeChangeClick($event)"
          [class.emptyPower]="isShowEmptyMarker && !data.startTime"
        >
          <label class="label-placeholder" *ngIf="!data.startTime">请选择</label>
          <label class="label-text" *ngIf="data.startTime">
            {{ data.startTime }}
          </label>
          <label class="label-choice">{{ timeStartLableTip }}</label>
        </div>
        <Calendar
          [(ngModel)]="startState.date"
          [locale]="startState.en ? 'enUS' : 'zhCN'"
          [visible]="startState.show"
          [defaultDate]="startState.now"
          [defaultValue]="startState.defaultValue"
          [maxDate]="startState.max"
          [pickTime]="startState.pickTime"
          [type]="startState.type"
          [rowSize]="startState.rowSize"
          prefixCls="energy"
          [onSelect]="startState.onSelect"
          (onCancel)="onCancel()"
        ></Calendar>
      </div>
    </div>
    <div id="endTime" class="modal-end-time">
      <label class="label-header">结束时间</label>
      <div class="mt10">
        <div class="lable-btn" (click)="timeEndChangeClick($event)">
          <label class="label-placeholder" *ngIf="!data.endTime">请选择（选填）</label>
          <label class="label-text" *ngIf="data.endTime">
            {{ data.endTime }}
          </label>
          <label class="label-choice" *ngIf="!data.endTime">{{ timeEndLableTip }}</label>
        </div>
        <Calendar
          [(ngModel)]="endState.date"
          [locale]="endState.en ? 'enUS' : 'zhCN'"
          [visible]="endState.show"
          [defaultDate]="endState.now"
          [defaultValue]="endState.defaultValue"
          [minDate]="startState.date"
          [pickTime]="endState.pickTime"
          [type]="endState.type"
          [rowSize]="endState.rowSize"
          prefixCls="energy"
          [onSelect]="endState.onSelect"
          (onCancel)="onCancelEnd()"
        ></Calendar>
      </div>
    </div>
  </div>
  <!-- 变更性质 -->
  <div id="changeType" class="modal-group mt15">
    <label class="label-header">变更性质</label>
    <div class="mt10">
      <div class="lable-btn" (click)="changeType($event)" [class.emptyPower]="isShowEmptyMarker && !data.changeType">
        <label class="label-placeholder" *ngIf="!data.changeType">请选择</label>
        <label class="label-text" *ngIf="data.changeType">
          {{ changeTypeName }}
        </label>
        <label class="label-choice">{{ changeTypeLableTip }}</label>
      </div>
    </div>
  </div>
  <!-- 录入方式 -->
  <div id="entryMode" class="modal-group mt15">
    <label class="label-header">录入方式</label>
    <div class="mt10">
      <div
        class="lable-btn"
        (click)="entryModeChange($event)"
        [class.emptyPower]="isShowEmptyMarker && !data.entryMode"
      >
        <label class="label-placeholder" *ngIf="!data.entryMode">请选择</label>
        <label class="label-text" *ngIf="data.entryMode">
          {{ entryModeName }}
        </label>
        <label class="label-choice">{{ entryModeLableTip }}</label>
      </div>
    </div>
  </div>
  <!-- 设备选择 -->
  <div id="energyNode" class="modal-group mt15" *ngIf="data.entryMode && +data.entryMode === 1">
    <label class="label-header">设备选择</label>
    <div class="mt10">
      <!-- <div class="lable-btn" (click)="equipmentChange($event)">
          <label class="label-placeholder" *ngIf="!data.energyNode">请输入</label>
          <label class="label-text" *ngIf="data.energyNode">
            {{ energyNodeName }}
          </label>
          <label class="label-choice"  >{{ energyNodeLableTip }}</label>
        </div> -->
      <ion-input
        class="label-input --with-button"
        [ngClass]="data.energyObjects ? 'modify' : 'select'"
        mode="md"
        readonly
        placeholder="请选择"
        [(ngModel)]="energyNodeName"
        (click)="equipmentChange($event)"
        [class.emptyPower]="isShowEmptyMarker && !data.energyObjects"
      ></ion-input>
    </div>
  </div>
  <!-- 能源类型 -->
  <div id="relationData" class="modal-group mt15" *ngIf="data.entryMode && +data.entryMode === 2">
    <div class="energy-header">
      <label class="label-header">能源用量</label>
      <label class="label-header-operation" *ngIf="operationRelation">
        <span class="label-delete ok-delete" (click)="delectOperation()" *ngIf="!delectOperationShow">删除</span>
        <span *ngIf="delectOperationShow">
          <span class="cancel-delete" (click)="cancelDelect()">取消</span>
          <span
            [ngClass]="{ 'no-delete': !selectEngeryChecked, 'ok-delete': selectEngeryChecked }"
            (click)="onDeleteEnergy()"
            >确认删除</span
          >
        </span>
      </label>
    </div>

    <div class="relation-data mt10" *ngFor="let control of relationData; let i = index; trackBy: trackByIndex">
      <div
        class="relation-data-energy"
        [id]="'relationData-' + i"
        [class.emptyPower]="
          isShowEmptyMarker && (!control.energyItemCode || !control.energyConsumption) && !control.newControl
        "
      >
        <div class="relation-energy-type">
          <ion-input
            class="label-input --with-button border-right-radius"
            [ngClass]="control.energyItemCode ? 'selectNotext' : 'select'"
            mode="md"
            readonly
            placeholder="能源类型"
            [(ngModel)]="control.energyItemCodeName"
            (click)="selectItemCodeModel(control, i)"
          ></ion-input>
        </div>
        <div class="relation-energy-consumption --div-after" [attr.data-content-after]="control.unit">
          <ion-input
            [id]="control.energyEventItemId"
            class="label-input --border-left-radius"
            [ngClass]="{ '--after-placenolder': delectOperationShow }"
            mode="md"
            placeholder="请输入用量"
            [(ngModel)]="control.energyConsumption"
            [appDecimalOnly]="decimalEC"
            [style.--padding-end]="control.pright"
            (keyup)="checkInput($event, control.energyEventItemId)"
            (keypress)="checkInput($event, control.energyEventItemId)"
            (ionChange)="energyChangeValue($event, control.energyEventItemId, i)"
          ></ion-input>
        </div>
      </div>

      <div class="checked-delete" *ngIf="delectOperationShow">
        <ion-checkbox
          color="primary"
          class="item-check ml10"
          [(ngModel)]="control.checked"
          mode="md"
          (ionChange)="selectEnergyDate(control, i)"
        >
        </ion-checkbox>
      </div>
    </div>
    <div class="mt10">
      <ion-button
        size="large"
        class="plus-btn-energy"
        type="submit"
        mode="md"
        [style.--box-shadow]="'none'"
        [style.--background]="'rgba(255, 255, 255, 1)'"
        [style.--border-style]="'dashed'"
        [style.--border-width]="'0.5px'"
        [style.--border-radius]="'5px'"
        [style.--border-color]="'rgba(18, 131, 255, 1)'"
        (click)="plusEnergy($event)"
      >
        <img src="assets/img/energy-events/plus-square.svg" class="mr10" />
        <span>新增</span>
      </ion-button>
    </div>
  </div>
  <div class="modal-group mt15">
    <label class="label-header">上传照片</label>
    <div class="label-tip-name mt10">最多上传6张照片（选填）；可上传外观、铭牌、房间位置</div>
    <div class="mt10">
      <app-em-image-upload [(ngModel)]="data.filePaths" (imageClick)="imageClick($event)"></app-em-image-upload>
    </div>
  </div>
  <div class="modal-group mt15">
    <label class="label-header">事件详情</label>
    <div class="mt10">
      <app-ems-speech-recognition
        (detailChange)="speechChangeDetail($event)"
        placeholder="请输入详细信息0/200（选填）"
        maxlength="200"
      ></app-ems-speech-recognition>
    </div>
  </div>
</div>
