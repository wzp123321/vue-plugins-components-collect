<div class="energy-analysis" style="width: 100%">
  <page-common
    :title="'能耗分析'"
    :showSearch="true"
    :showExport="!isDepartment"
    :reportExportTitle="wordExportLoading? '报告正在导出' : '报告导出'"
    @report-export="reportExport"
  >
    <template v-slot:pageSearch>
      <ea-search
        @search-submit="searchSubmit"
        @handleSearch="handleSearch"
        @error="onInitialValueError"
        @resetTreeType="resetTreeType"
      >
      </ea-search>
    </template>
    <template v-slot:pageContent>
      <div style="height: 100%" v-if="!unConfigureFlag && !isDepartment">
        <el-row :gutter="24" class="module-wrap" style="height: 375px">
          <!-- 能耗分析柱状折线图 start -->
          <el-col :span="searchParam.valueMean === '1' ? 12 : 24">
            <module-subhead :title="'能耗分析'"></module-subhead>
            <div style="width: 100%; height: calc(100% - 22px)" v-loading="barChartLoading">
              <ea-line-bar-chart
                ref="lingChartRef"
                v-if="
                      barChart && !showBarChartNoData &&
                        !barChartLoading &&
                        barChart.barChartSeriesList[0].values &&
                        barChart.barChartSeriesList[0].values.length > 0
                    "
                :barData="barChart.barChartSeriesList"
                :yAxisItems="barChart.yaxisItemList"
                :xAxisTimes="barChart.xaxisTimes"
                :legendDataException="barChart.legendDataList"
                :unit="barChart.timeUnit"
                :compareTitle="
                      barChart.barChartSeriesList?.length &&
                      barChart.barChartSeriesList[0].energyType
                        ? barChart.barChartSeriesList[0].energyType === '总能耗' ? barChart.barChartSeriesList[0].energyType :
                        `${barChart.barChartSeriesList[0].energyType}能耗`
                        : ''
                    "
                :valueMean="searchParam.valueMean"
                :timeSection="timeSection"
                @bar-chart-click="barClick($event)"
              ></ea-line-bar-chart>
              <div class="flex flex-align-center" style="height: 100%; width: 100%" v-if="showBarChartNoData">
                <no-data :title="unConfigureMessage"></no-data>
              </div>
            </div>
          </el-col>
          <!-- 能耗分析柱状折线图 end -->
          <!-- 数据钻取 start -->
          <el-col :span="12" v-if="searchParam.valueMean === '1'" class="mt10">
            <div class="data-drilling-head">
              <div class="data-drilling-head-title">
                <span v-show="drillingTime">{{ drillingTime }}<span class="ml21">数据钻取</span></span>
              </div>
              <div style="display: flex; align-items: center">
                <el-tooltip style="margin-right: 8px" effect="dark" placement="left">
                  <template #content>
                    <div style="white-space: normal; word-break: break-all">
                      同比定义：去年同期值，如2016年11月，同比2015年11月；
                    </div>
                    <div style="white-space: normal; word-break: break-all">
                      环比定义：上个周期值，如11月5日，环比11月4日；
                    </div>
                    <div style="white-space: normal; word-break: break-all">补充说明：</div>
                    <div style="white-space: normal; word-break: break-all">
                      1、同环比计算的最小颗粒度为天，10分钟、1小时颗粒度不计算同环比；
                    </div>
                    <div style="white-space: normal; word-break: break-all">
                      2、包含当天（未满24小时）则不计算同环比，如天颗粒度的当天、月颗粒度的当月、年颗粒度的当年；
                    </div>
                    <div style="white-space: normal; word-break: break-all">
                      3、天颗粒度，跨月数据不计算环比，仍计算同比，月颗粒度，跨月数据（不含当月）仍计算同环比；
                    </div>
                    <div style="white-space: normal; word-break: break-all">4、跨年数据不计算同环比。</div>
                  </template>
                  <img class="question_mark" src="../../../assets/img/energy-anomaly/ea-question-mark.svg" />
                </el-tooltip>
                <switch-button
                  style="float: right"
                  v-model="switchSelect"
                  :switchItems="switchItems"
                  @switch-button-change="switchChange"
                ></switch-button>
              </div>
            </div>
            <div class="data-drilling-crumbs flex-row-start-center">
              <img @click="crumbHomeClick" src="../../../assets/img/common/common-home-icon.svg" />
              <span v-for="(item, index) in dataDrillingNameArr" :key="index">
                <svg
                  style="margin-left: 8px"
                  class="icon"
                  height="12"
                  p-id="7730"
                  t="1611208675851"
                  version="1.1"
                  viewBox="0 0 1024 1024"
                  width="12"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    _ngcontent-fxr-c13=""
                    d="M175.396571 128.731429a8.045714 8.045714 0 0 0-4.169142 4.242285l-0.585143 2.998857v82.212572c0 3.072 0.877714 5.997714 2.486857 8.557714l2.925714 3.437714 322.56 287.963429-322.56 287.963429a16.018286 16.018286 0 0 0-4.754286 7.460571l-0.658285 4.461714v82.212572a8.045714 8.045714 0 0 0 2.194285 5.558857l2.56 1.755428 2.925715 0.731429 3.072-0.512 2.633143-1.536 407.917714-364.251429a31.963429 31.963429 0 0 0 2.56-45.202285l-1.243429-1.316572-1.316571-1.243428-407.917714-364.251429-2.633143-1.462857-2.998857-0.512z m272.018286 0a8.045714 8.045714 0 0 0-4.169143 4.242285l-0.585143 2.998857v82.212572c0 3.072 0.877714 5.997714 2.486858 8.557714l2.925714 3.437714 322.56 287.963429-322.56 287.963429a16.018286 16.018286 0 0 0-4.754286 7.460571l-0.658286 4.461714v82.212572a8.045714 8.045714 0 0 0 2.194286 5.558857l2.56 1.755428 2.925714 0.731429 2.998858-0.512 2.633142-1.536 407.990858-364.251429a31.963429 31.963429 0 0 0 2.56-45.202285l-1.243429-1.316572-1.316571-1.243428-407.990858-364.251429-2.633142-1.462857-2.925715-0.512z"
                    fill="#000000"
                    opacity=".65"
                    p-id="7731"
                  ></path>
                </svg>
                <span class="dd-crumbs-name" @click="crumbObjectNameClick(item, index)">{{ item.name }}</span>
              </span>
            </div>
            <div style="height: calc(100% - 73px)" v-loading="dataDrillingLoading">
              <data-drilling
                v-if="!showDataDrillingNoData && dataDrillingTable.data &&dataDrillingTable.data.length > 0 &&!dataDrillingLoading
                    "
                :dataList="dataDrillingTable.data"
                :isLeaf="dataDrillingTable.isLeaf"
                :unit="dataDrillingTable.unit"
                :unitTime="timeUnitValue"
                :timeSection="timeSection"
                @object-name-click="objectNameClick"
              ></data-drilling>
              <no-data
                v-if="showDataDrillingNoData &&(!dataDrillingTable.data ||
                        dataDrillingTable.data.length === 0) &&
                        !dataDrillingLoading
                    "
              ></no-data>
            </div>
          </el-col>
          <!-- 数据钻取 end -->
        </el-row>
        <el-row :gutter="24" class="module-wrap" style="height: 451px" v-if="searchParam.valueMean === '1'">
          <!-- 能耗统计分析-同环比 start -->
          <el-col :span="12">
            <module-subhead :title="'能耗统计分析'"></module-subhead>
            <div style="width: 100%; height: calc(100% - 22px)" v-loading="statisticalLoading">
              <statistical-analysis
                :data="statisticalData"
                v-if="!showstatisticalNoData && statisticalData && !statisticalLoading"
              >
              </statistical-analysis>
              <no-data v-if="!statisticalData && !statisticalLoading && showstatisticalNoData"></no-data>
            </div>
          </el-col>
          <!-- 能耗统计分析-同环比 end -->
          <!-- 能耗分解-环形图 start -->
          <el-col :span="12">
            <module-subhead :title="'能耗分解'"></module-subhead>
            <div style="width: 100%; height: calc(100% - 22px)" v-loading="pieChartLoading">
              <energy-consumption-decompose
                ref="analysisPieRef"
                :pieChart="pieChart"
                :attribute="{ treeName: treeName, deviceNumber: deviceNumber,hasDirectDevice: hasDirectDevice,rangeDate: rangeDate }"
                :timeSection="timeSection"
                :searchParam="searchParam"
                v-if="pieChart && !pieChartLoading && !showPieChartNoData"
              >
              </energy-consumption-decompose>
              <no-data v-show="showPieChartNoData && !pieChartLoading" :title="unConfigureMessage"> </no-data>
            </div>
          </el-col>
          <!-- 能耗分解-环形图 end -->
        </el-row>
        <el-row :gutter="24">
          <!-- 能耗明细 start -->
          <el-col :span="24">
            <div style="display: flex; justify-content: space-between; margin-bottom: 19px">
              <module-subhead :title="'能耗明细'"></module-subhead>
              <button
                primary
                v-if="energyTableList &&energyTableList.length > 0 &&!barChartLoading"
                @click="exportTable"
              >
                {{ exportTableLoading ? '正在导出' : '导出'}}
              </button>
            </div>
            <div v-loading="barChartLoading" :style="{height: barChartLoading? '300px' : 'calc(100% - 41px)'}">
              <energy-consumption-detail
                v-if="energyTableList && energyTableList.length > 0 && !barChartLoading"
                :listData="energyTableList"
                :unit="tableUnit"
                :columnName="tableColumnName"
                :valueMean="tableValueMean"
                :unitTime="timeUnitValue"
                :timeSection="timeSection"
              ></energy-consumption-detail>
              <no-data
                style="padding-bottom: 16px"
                :title="unConfigureMessage"
                v-if=" (!energyTableList || (energyTableList && energyTableList.length === 0)) && !barChartLoading"
              >
              </no-data>
            </div>
          </el-col>
          <!-- 能耗明细 end -->
        </el-row>
      </div>
      <!-- 只有查科室树的时候才展示 -->
      <div style="height: 100%" v-show="!unConfigureFlag && isDepartment">
        <el-row :gutter="24" class="module-wrap" style="height: 375px">
          <el-col :span="24">
            <module-subhead :title="'能耗分析'"></module-subhead>
            <ea-office-analysis></ea-office-analysis>
          </el-col>
        </el-row>
        <el-row :gutter="24" class="module-wrap" style="height: 451px">
          <el-col :span="24" style="display: flex; flex-direction: column">
            <module-subhead :title="'能耗分解'"></module-subhead>
            <ea-office-decompose></ea-office-decompose>
          </el-col>
        </el-row>
        <el-row :gutter="24">
          <!-- 能耗明细 start -->
          <el-col :span="24">
            <ea-office-detail></ea-office-detail>
          </el-col>
          <!-- 能耗明细 end -->
        </el-row>
      </div>
      <no-data :title="unConfigureMessage" v-show="unConfigureFlag"> </no-data>
    </template>
  </page-common>
</div>
