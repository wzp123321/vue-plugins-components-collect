<div class="report-management">
  <page-common title="报告报表管理" :showSearch="true" :isSubHead="true" :subTitle="'报告报表管理'">
    <template v-slot:pageSearch>
      <!-- 头部 -->
      <el-form :inline="true" :model="formInline" class="demo-form-inline" @submit.native.prevent>
        <el-form-item>
          <el-input
            placeholder="请输入报告或报表名称"
            v-model.trim="formInline.search"
            v-inputFilter:search
            :maxlength="32"
            @keyup.enter="onSearch"
            style="width: 350px"
            suffix-icon="el-icon-search"
          ></el-input>
        </el-form-item>
        <el-form-item label="类型">
          <el-select v-model="formInline.type" placeholder="请选择类型">
            <el-option v-for="(item, index) in typeList" :key="index" :label="item.name" :value="item.code"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="来源">
          <el-select v-model="formInline.source" placeholder="请选择归属模块">
            <el-option
              v-for="(item, index) in sourceList"
              :key="index"
              :label="item.name"
              :value="item.code"
            ></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="生成时间">
          <el-date-picker
            v-model="formInline.date"
            type="daterange"
            :disabledDate="onDisableDateCb"
            range-separator="~"
            start-placeholder="开始日期"
            end-placeholder="结束日期"
            :clearable="false"
            prefix-icon="iconfont icon-Calendar"
            clear-icon="iconfont icon-Close-Circle-Fill"
          ></el-date-picker>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="onSearch">查询</el-button>
          <el-button class="resetBtn" @click="onReset">重置</el-button>
        </el-form-item>
      </el-form>
    </template>
    <template v-slot:pageSubHead>
      <el-button class="deleteBtn" v-if="abnormal" @click="deleteAsync">删除</el-button>
      <el-button v-if="abnormal" @click="uploadAsync">上传</el-button>
      <el-button v-if="abnormal" type="primary" @click="downloadBatchAsync"
        >{{ reportDownLoadLoading ? '正在下载' : '下载' }}</el-button
      >
    </template>
    <template v-slot:pageContent>
      <div style="height: 100%" v-loading="loading">
        <el-table
          v-if="!loading"
          ref="multipleTable"
          :data="tableData"
          :stripe="lightOrDark"
          style="width: 100%"
          @selection-change="handleSelectionChange"
          :default-sort="{ prop: `${tableSortName}`, order: `${sortCode}` }"
          sort-orders="['descending','ascending','descending']"
          @sort-change="sortChange"
        >
          <el-table-column type="selection" />
          <el-table-column prop="index" label="序号" width="80" align="center">
            <template #default="scope"> {{ (pageNum - 1) * pageSize + scope.$index + 1 }} </template>
          </el-table-column>
          <el-table-column prop="reportName" label="名称" min-width="424" align="center">
            <template #default="scope">
              <el-tooltip
                class="tips"
                effect="dark"
                :content="scope.row.reportName"
                placement="bottom"
                :offset="4"
                :show-after="500"
              >
                <div class="text">{{ scope.row.reportName }}</div>
              </el-tooltip>
            </template>
          </el-table-column>
          <el-table-column prop="reportType" label="类型" min-width="127" align="center" sortable="custom">
            <template #default="scope">
              <el-tooltip
                class="tips"
                effect="dark"
                :content="scope.row.reportType === '1' ? '报告' : '报表'"
                placement="bottom"
                :offset="4"
                :show-after="500"
              >
                <div class="text">{{ scope.row.reportType === '1' ? '报告' : '报表' }}</div>
              </el-tooltip>
            </template>
          </el-table-column>
          <el-table-column prop="createTime" label="生成时间" min-width="135" align="center" sortable="custom">
            <template #default="scope">
              <el-tooltip
                class="tips"
                effect="dark"
                :content="scope.row.createTime"
                placement="bottom"
                :offset="4"
                :show-after="500"
              >
                <div class="text">{{ scope.row.createTime }}</div>
              </el-tooltip>
            </template>
          </el-table-column>
          <el-table-column prop="sourceType" label="来源" min-width="127" align="center" sortable="custom">
            <template #default="scope"> {{ scope.row.sourceType === '1' ? '系统生成' : '用户上传' }} </template>
          </el-table-column>
          <el-table-column prop="address" label="操作" width="220" align="center">
            <template #default="scope">
              <span class="operate-span mr16" @click="downLoad(scope.row)">下载</span>
              <el-popconfirm
                title="确认删除该条数据吗?"
                @confirm="deleteItemAsync([scope.row.id])"
                confirmButtonText="确定"
                cancelButtonText="取消"
                cancelButtonType="default"
              >
                <template #reference>
                  <span class="delete-span">删除</span>
                </template>
              </el-popconfirm>
            </template>
          </el-table-column>
        </el-table>
        <el-pagination
          :pager-count="6"
          v-if="!loading && total > 0"
          :current-page="pageNum"
          :page-sizes="pageSizes"
          @size-change="onPageSizeChange"
          @current-change="onCurrentChange"
          :page-size="pageSize"
          layout="total, prev, pager, next, sizes, jumper"
          :total="total"
        >
        </el-pagination>
      </div>
    </template>
  </page-common>

  <!-- 上传弹框 -->
  <UploadDialod
    :dialogAdd="dialogAdd"
    :typeList="typeList.slice(1)"
    @uploaddOK="onUploaddOK"
    :key="nums"
  ></UploadDialod>
</div>
